function _await(t,e,r){return r?e?e(t):t:(t&&t.then||(t=Promise.resolve(t)),e?t.then(e):t)}function _catch(t,e){try{var r=t()}catch(a){return e(a)}return r&&r.then?r.then(void 0,e):r}function _async(t){return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];try{return Promise.resolve(t.apply(this,e))}catch(a){return Promise.reject(a)}}}function tcalc__init(t,e){var r=document.querySelector("#rec"+t);if(r){var a=r.querySelectorAll('[data-input-lid="'+e+'"]'),c;if(Boolean(r.querySelector(".t-conditional-form"))){var n="conditional-form-init";r.addEventListener(n,(function(){for(var t=0;t<a.length;t++)o(a[t])}),{once:!0})}else for(var l=0;l<a.length;l++)o(a[l])}function o(e){if(e&&!e.getAttribute("data-init-calc")){var a=e.querySelector(".t-calc");a||(a=r.querySelector(".t-calc"));var c=a.getAttribute("data-calc-expr"),n=r.querySelectorAll(".t-select, .t-radio, .t-checkbox, .t-img-select, .t-rate"),l=r.querySelectorAll(".t-inputquantity__btn"),o=r.querySelectorAll(".t-input"),i=r.querySelectorAll(".t-range");if(c){var s=tcalc__getParseExpression(c=c.replace(/\s/g,"").replace(/,/g,"."));if(tcalc__cashOperandsFieldsEls(r,s),tcalc__cutAndHideFieldsValues(s),!0!==s.error){if(t_onFuncLoad("t_throttle",(function(){Array.prototype.forEach.call(o,(function(t){t.addEventListener("input",t_throttle((function(){tcalc__changeVal(r,e,a,tcalc__calcValue(s))})))}))})),Array.prototype.forEach.call(n,(function(t){t.addEventListener("change",(function(){tcalc__changeVal(r,e,a,tcalc__calcValue(s))}))})),Array.prototype.forEach.call(l,(function(t){t.addEventListener("click",(function(){setTimeout((function(){tcalc__changeVal(r,e,a,tcalc__calcValue(s))}))}))})),Array.prototype.forEach.call(i,(function(t){Array.prototype.forEach.call(["click","input","change"],(function(c){t.addEventListener(c,(function(){tcalc__changeVal(r,e,a,tcalc__calcValue(s))}))}))})),e.addEventListener("recalculate",(function(){tcalc__changeVal(r,e,a,tcalc__calcValue(s))})),tcalc__addConditionalListeners(e,s),tcalc__changeVal(r,e,a,tcalc__calcValue(s)),e.setAttribute("data-init-calc","y"),e.dispatchEvent(new CustomEvent("inputReady")),e.setAttribute("data-input-ready","true"),tcalc__isTeam()||tcalc__isTester()){var u=r.querySelector(".t-quiz"),_;(u?u.querySelectorAll("button.t-submit"):r.querySelectorAll('[class$="-form__submit"] button.t-submit')).forEach((function(t){t.removeEventListener("click",tcalc__addProductsToCart,!0),t.addEventListener("click",tcalc__addProductsToCart,!0)}))}}else console.log("Please check math expression or input names(especially spaces) in rec"+t)}else console.log("Error: formula field is empty in rec"+t)}}}function tcalc__getParseExpression(t){var e=t.split(""),r=[],a=[],c=0,n=!0;r[c]=Object.create(null),r[c].str="";for(var l=0;l<e.length;l++)"("!==e[l]&&")"!==e[l]&&("+"!==e[l]&&"-"!==e[l]&&"*"!==e[l]&&"/"!==e[l]||n?(r[c].str+=e[l],n=!1):(a[c]=e[l],r[++c]=Object.create(null),r[c].str="",n=!0));return{str:t,operands:r,operators:a}}function tcalc__cashOperandsFieldsEls(t,e){for(var r=0;r<e.operands.length;r++){var a=e.operands[r].str;if(isNaN(a)){var c=t.querySelectorAll('[name="'+a+'"]'),n=Array.from(c).some((function(t){return Boolean(t.closest(".t-input-group[data-conditionals], .t-conditional"))}));if(!c)return console.log("Error: incorrect operand: "+a),void(e.error=!0);e.operands[r].type="variable",e.operands[r].field=c,e.operands[r].hasConditionalField=n}else e.operands[r].type="number",e.operands[r].value=+e.operands[r].str}}function tcalc__cutAndHideFieldsValues(t){for(var e=0;e<t.operands.length;e++){var r=t.operands[e];"variable"===r.type&&tcalc__prepareFieldsValues(r.field)}}function tcalc__prepareFieldsValues(t){t.forEach((function(t){if(t){var e=t.classList.contains("t-select"),r=t.classList.contains("t-radio"),a=t.classList.contains("t-checkbox"),c=t.classList.contains("t-checkboxes__hiddeninput"),n=t.classList.contains("t-img-select"),l=t.classList.contains("t-img-select__hiddeninput"),o=t.classList.contains("t-rate");if(e)tcalc__cleanDropdownSelectValues(t);else if(a||r)tcalc__cleanRadioOrCheckboxValues(t);else if(n)tcalc__cleanImgSelectValues(t);else if(o)tcalc__setRateValues(t);else{var i=t.closest(".t-input-block");c?tcalc__prepareFieldsValues(i.querySelectorAll(".t-checkbox")):l&&tcalc__prepareFieldsValues(i.querySelectorAll(".t-img-select"))}}}))}function tcalc__changeVal(t,e,r,a){var c=e.querySelector(".t-calc__hiddeninput");c||(c=t.querySelector(".t-calc__hiddeninput"));var n=c.value,l;if(isNaN(a)?(r.innerHTML=0,c.value=0):(r.innerHTML=a,c.value=a),e.querySelector('input[type="hidden"][class^="t-calc__hidden__prod"]')){var o=e.closest(".t-form__inputsbox"),i=e.querySelector(".t-calc__hidden__prod_img"),s=e.querySelector(".t-calc__hidden__prod_title"),u,_="",d="",p=tcalc__parseProductOptions(e.querySelector(".t-calc__hidden__prod_options"));i&&(_=i.value||""),s&&(d=s.value||"NoName");var f={str:d,variables:[]},v=f.str.match(/[A-z0-9_]+/gi);for(var m in v){var h=o.querySelectorAll('[type="radio"][name="'+v[m]+'"]:checked');if(1===h.length)f.variables.push({str:v[m],value:h[0].value});else{var y=o.querySelectorAll('[name="'+v[m]+'"]');1===y.length&&f.variables.push({str:v[m],value:y[0].value})}}for(var g in f.variables){var b=f.variables[g].str,A=f.variables[g].value;if(A.indexOf("=")>0){for(var E=A.split(";"),S=[],m=0;m<E.length;m++){var x=E[m];x.indexOf("=")>0?S.push(x.split("=")[0]):S.push(x)}A=S.join(";")}b&&A&&(d=d.replace(new RegExp(b),A))}var w=t.querySelector(".t-quiz"),q=w?w.querySelectorAll("button.t-submit"):o.querySelectorAll('[class$="-form__submit"] button.t-submit'),F="#order:"+d+"="+a;_&&(F+=":::image="+_),tcalc__isTeam()||tcalc__isTester()?tcalc__processCalcProduct({inputGroup:e,title:d,img:_,price:a,submitBtns:q,options:p}):q.forEach((function(t){t.setAttribute("href",F),t.setAttribute("type","")}))}Number(n)!==a&&t_triggerEvent(c,"change")}function tcalc__processCalcProduct(t){var e=t.inputGroup,r=t.title,a=t.img,c=t.price,n=t.submitBtns,l=t.options,o=null!==e.closest('[data-hidden-by-condition="true"]'),i=tcalc__productHelper(e);if(i){var s=e.getAttribute("data-input-lid"),u={name:r,price:c,img:a,options:l};o?i.remove(s):i.set(s,u);var _=!i.isEmpty();n.forEach((function(t){t.removeAttribute("href"),t.setAttribute("type",_?"":"submit")}))}}window.productsFromCalc=window.productsFromCalc||{};var tcalc__addProductsToCart=_async((function(t){return _catch((function(){var e;if(document.querySelector(".t706")){var r,a=tcalc__productHelper(t.currentTarget);if(a&&!a.isEmpty())return t.stopPropagation(),t.preventDefault(),_await(tcalc__prepareProductsForCart(a),(function(t){var e=a.rec.querySelector(".t-popup.t-popup_show");e&&t_onFuncLoad("t_popup__closePopup",(function(){t_popup__closePopup(e)})),t_onFuncLoad("tcart__addProduct",(function(){t.forEach((function(t){tcart__addProduct(t)}))}))}))}}),(function(t){console.error("Error trying to add calculator product to cart:",t)}))}));function tcalc__productHelper(t){var e=t.closest(".t-rec");if(e){var r=t.closest(".t396__elem"),a=r?r.getAttribute("data-elem-id"):e.getAttribute("id").replace("rec","");window.productsFromCalc=window.productsFromCalc||{},window.productsFromCalc[a]=window.productsFromCalc[a]||{};var c=window.productsFromCalc[a];return{rec:e,recId:a,products:c,get:function t(e){return c[e]},set:function t(e,r){c[e]=r},remove:function t(e){c[e]&&delete c[e]},isEmpty:function t(){return 0===Object.keys(c).length},getAllProducts:function t(){return Object.values(c)}}}}function tcalc__parseProductOptions(t){return null!=t&&t.value?t.value.split("\n").map((function(t){var e=t.split("="),r=e[0],a=e[1];if(r)return{field:r.trim(),title:(a||"").trim()}})).filter(Boolean):[];var e,r}var tcalc__prepareProductOptions=function t(e,r){return e?e.map((function(t){var e=t.field,a=t.title,c=r[e]||"";return Array.isArray(c)&&(c=c.join("; ")),{option:a||e,variant:c}})):[]},tcalc__prepareProductsForCart=_async((function(t){return _catch((function(){var e=t.rec,r=t.getAllProducts;return _await(tcalc__getUserFormData(e),(function(t){if(!t)return[];var e,a=r().map(_async((function(e){return _await(tcalc__prepareProductOptions(e.options,t),(function(t){return Object.assign({},e,{options:t})}))})));return _await(Promise.all(a))}))}),(function(t){console.error("Error preparing calculator products for cart:",t)}))})),tcalc__getUserFormData=_async((function(t){return _catch((function(){var e=t.querySelector(".t-form");return e?_await(new Promise((function(t){return t_onFuncLoad("t_forms__getFormDataJSON",t)})),(function(){var t=window.t_forms__getFormDataJSON(e);return t||null})):null}),(function(t){return console.error("Error getting form data for calculator:",t),null}))}));function tcalc__calcValue(t){tcalc__getFieldsValues(t);for(var e=t.str,r=0;r<t.operands.length;r++){var a=t.operands[r],c=tcalc__isOperandFieldHiddenByCondition(a),n=tcalc__doesOperandFieldExist(a),l=c||!n?0:a.value;l=l<0?"(0"+l+")":l,e=e.replace(a.str,l)}try{var o=tcalc__evaluate(tcalc__parse(e))}catch(i){console.log("Something went wrong in form calculator! Please, connect support or developers")}return Math.round(10*o)/10}function tcalc__getFieldsValues(t){for(var e=0;e<t.operands.length;e++)if("variable"==t.operands[e].type){var r=t.operands[e].field;(r=Array.prototype.slice.call(r)).forEach((function(a){if(a){var c=a.classList.contains("t-img-select")&&"radio"===a.getAttribute("type"),n=a.classList.contains("t-img-select__hiddeninput");if(a.classList.contains("t-input")||a.classList.contains("t-range")||a.classList.contains("t-calc__hiddeninput")){var l=a.value;tcalc__getFieldsValues__saveToArr(t.operands[e],l)}if(a.classList.contains("t-select")){var o=a.querySelector("option:checked"),l=0;o&&(l=o.getAttribute("data-calc-value")),tcalc__getFieldsValues__saveToArr(t.operands[e],l)}if(a.classList.contains("t-radio")||a.classList.contains("t-checkbox")||a.classList.contains("t-rate")||c){var i=Array.prototype.filter.call(r,(function(t){if(t.checked)return t})),l=0;i[0]&&(l=i[0].getAttribute("data-calc-value")),tcalc__getFieldsValues__saveToArr(t.operands[e],l)}if(a.classList.contains("t-checkboxes__hiddeninput")||n){var s=a.closest(".t-input-block"),u=n?s.querySelectorAll(".t-img-select:checked"):s.querySelectorAll(".t-checkbox:checked"),_=0;Array.prototype.forEach.call(u,(function(t){var e=t.getAttribute("data-calc-value");e=e?e.replace(/[^0-9.]/g,""):0,_+=parseFloat(e)})),tcalc__getFieldsValues__saveToArr(t.operands[e],_.toString())}}}))}}function tcalc__getFieldsValues__saveToArr(t,e){var r=parseInt(e,10)<0;e=e?e.replace(/,/g,".").replace(/[^0-9.]/g,""):"",t.value=e?parseFloat(e):0,r&&(t.value=-t.value)}function t_triggerEvent(t,e){var r;document.createEvent?(r=document.createEvent("HTMLEvents")).initEvent(e,!0,!1):document.createEventObject&&((r=document.createEventObject()).eventType=e),r.eventName=e,t.dispatchEvent?t.dispatchEvent(r):t.fireEvent?t.fireEvent("on"+r.eventType,r):t[e]?t[e]():t["on"+e]&&t["on"+e]()}function tcalc__evaluate(t){switch(t.type){case"number":return parseFloat(t.value);case"+":return tcalc__evaluate(t.left)+tcalc__evaluate(t.right);case"-":return tcalc__evaluate(t.left)-tcalc__evaluate(t.right);case"*":return tcalc__evaluate(t.left)*tcalc__evaluate(t.right);case"/":return tcalc__evaluate(t.left)/tcalc__evaluate(t.right)}}function tcalc__parse(t){var e={tokens:tcalc__tokenize(t),position:0},r=tcalc__parseExpr(e);if(e.position!==e.tokens.length)throw new SyntaxError("unexpected '"+tcalc__peek(e)+"'");return r}function tcalc__tokenize(t){for(var e=[],r=/\s*([A-Za-z]+|[0-9.]+|\S)\s*/g,a;a=r.exec(t);)e.push(a[1]);return e}function tcalc__parseExpr(t){for(var e=tcalc__parseMulExpr(t),r=tcalc__peek(t);"+"===r||"-"===r;){var a;tcalc__consume(t),e={type:r,left:e,right:tcalc__parseMulExpr(t)},r=tcalc__peek(t)}return e}function tcalc__parseMulExpr(t){for(var e=tcalc__parsePrimaryExpr(t),r=tcalc__peek(t);"*"===r||"/"===r;){var a;tcalc__consume(t),e={type:r,left:e,right:tcalc__parsePrimaryExpr(t)},r=tcalc__peek(t)}return e}function tcalc__parsePrimaryExpr(t){var e=tcalc__peek(t);if(tcalc__isNumber(e))return tcalc__consume(t),{type:"number",value:e};if(tcalc__isName(e))return tcalc__consume(t),{type:"name",id:e};if("("===e){tcalc__consume(t);var r=tcalc__parseExpr(t);if(")"!==tcalc__peek(t))throw new SyntaxError("expected )");return tcalc__consume(t),r}throw new SyntaxError("expected a number, a variable, or parentheses")}function tcalc__peek(t){return t.tokens[t.position]}function tcalc__consume(t){t.position++}function tcalc__isName(t){return t&&t.match(/^[A-Za-z]+$/)}function tcalc__isNumber(t){return t&&t.match(/^[0-9.]+$/)}function tcalc__isOperandFieldHiddenByCondition(t){if("variable"===t.type)return t.hasConditionalField&&Array.from(t.field).some((function(t){var e=t.closest(".t-conditional"),r=t.closest(".t-input-group");return tcalc__isHiddenByCondition(e)||tcalc__isHiddenByCondition(r)}))}function tcalc__doesOperandFieldExist(t){return"variable"!==t.type||t.field.length>0}function tcalc__cleanImgSelectValues(t){var e=t.closest(".t-img-select__control"),r=e.querySelector(".t-img-select__text");if(r){var a=r.textContent.trim();if(a){var c=a.split("=");c.length<2||(c[0]?t.setAttribute("value",c[0]):t.setAttribute("value",e.querySelector(".t-img-select__indicator").getAttribute("data-original")),t.setAttribute("data-calc-value",c[1]),r.textContent=c[0])}}}function tcalc__setRateValues(t){t.setAttribute("data-calc-value",t.value)}function tcalc__cleanRadioOrCheckboxValues(t){var e=t.classList.contains("t-radio"),r=e?t.closest(".t-radio__control"):t.closest(".t-checkbox__control"),a=r.querySelector(".t-checkbox__labeltext"),c=r.textContent.trim();if(a&&(c=a.textContent),c){var n=c.split("=");if(!(n.length<2)){var l=n[0],o=n[1];if(t.closest(".t-input-group_rd")&&t.setAttribute("value",l),t.setAttribute("data-calc-value",o),a)a.textContent=l;else{var i;if(e?t.classList.contains("t-radio-ownanswer"):t.classList.contains("t-checkbox-ownanswer")){var s=e?r.querySelector(".t-radio__title"):r.querySelector(".t-checkbox__title");return s&&(s.textContent=l),void t.setAttribute("data-own-variant-title",l)}var u=r.querySelector("span:last-child");u&&(u.textContent=l)}}}}function tcalc__cleanDropdownSelectValues(t){var e=t.querySelectorAll("option");Array.prototype.forEach.call(e,(function(t){var e=t.value;if(e){var r=e.split("=");r.length<2||(t.value=r[0],t.innerHTML=r[0],t.setAttribute("data-calc-value",r[1]))}}))}function tcalc__isHiddenByCondition(t){return t&&"true"===t.getAttribute("data-hidden-by-condition")}function tcalc__addConditionalListeners(t,e){var r=e.operands,a=t.getAttribute("data-input-lid"),c=function e(){return t.dispatchEvent(new CustomEvent("recalculate"))},n=r.flatMap((function(t){return"variable"!==t.type?[]:Array.from(t.field).flatMap((function(t){var e,r;return[t.closest(".t-conditional"),t.closest(".t-input-group[data-conditionals]")]})).filter(Boolean);var e,r})),l;n.some((function(t){var e;return JSON.parse(t.getAttribute("data-conditionals")).conditions.some((function(t){return t.fieldId===a}))}))?console.error("Could not add conditional listeners because of a circular dependency. Formula: "+e.str+". Input ID: "+a):n.forEach((function(t){t.removeEventListener("conditional-state-change",c),t.addEventListener("conditional-state-change",c)}))}function tcalc__isTeam(){var t=document.getElementById("allrecords");return t&&"y"===t.getAttribute("data-tilda-te")}function tcalc__isTester(){var t=document.getElementById("allrecords");return t&&"y"===t.getAttribute("data-tilda-ts")}
